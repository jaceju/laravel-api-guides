# å¯æ“´å±•çš„ Laravel æ¡†æ¶è¨­ç½®

åœ¨ä¼æ¥­ç´š API å°ˆæ¡ˆä¸­ï¼Œæ¡†æ¶çš„åˆå§‹è¨­ç½®æ±ºå®šäº†æ•´å€‹å°ˆæ¡ˆçš„ç™¼å±•æ½›åŠ›ã€‚æœ¬ç« å°‡æ¢è¨å¦‚ä½•å»ºç«‹ä¸€å€‹æ—¢ç©©å›ºåˆå…·æœ‰é«˜åº¦æ“´å±•æ€§çš„ Laravel åŸºç¤æ¶æ§‹ã€‚

## ğŸ¯ è¨­è¨ˆå¯æ“´å±•æ¶æ§‹çš„æ ¸å¿ƒè€ƒé‡

### ç‚ºä»€éº¼å‚³çµ±è¨­ç½®ä¸è¶³ä»¥æ‡‰å°å¤§å‹å°ˆæ¡ˆ

å‚³çµ±çš„ Laravel å®‰è£é›–ç„¶é©åˆå¿«é€ŸåŸå‹é–‹ç™¼ï¼Œä½†åœ¨é¢å°å¤§å‹å°ˆæ¡ˆæ™‚æœƒé‡åˆ°ä»¥ä¸‹æŒ‘æˆ°ï¼š

#### åŠŸèƒ½è€¦åˆå•é¡Œ
- **å–®é«”æ¶æ§‹é™åˆ¶** - æ‰€æœ‰åŠŸèƒ½é›†ä¸­åœ¨å–®ä¸€æ‡‰ç”¨ä¸­ï¼Œé›£ä»¥ç¨ç«‹é–‹ç™¼å’Œéƒ¨ç½²
- **ä¾è³´é—œä¿‚è¤‡é›œ** - ç¼ºä¹æ¸…æ™°çš„æ¨¡çµ„é‚Šç•Œï¼Œå°è‡´åŠŸèƒ½é–“éåº¦è€¦åˆ
- **æ¸¬è©¦å›°é›£** - åŠŸèƒ½äº¤éŒ¯ä½¿å¾—å–®å…ƒæ¸¬è©¦å’Œæ•´åˆæ¸¬è©¦è®Šå¾—è¤‡é›œ

#### æ“´å±•æ€§ç“¶é ¸
- **æ•ˆèƒ½é™åˆ¶** - å–®ä¸€æ‡‰ç”¨æ‰¿è¼‰æ‰€æœ‰æ¥­å‹™é‚è¼¯ï¼Œé›£ä»¥é‡å°ç‰¹å®šåŠŸèƒ½é€²è¡Œæ•ˆèƒ½èª¿å„ª
- **åœ˜éšŠå”ä½œéšœç¤™** - å¤šå€‹é–‹ç™¼åœ˜éšŠé›£ä»¥ä¸¦è¡Œé–‹ç™¼ä¸åŒåŠŸèƒ½æ¨¡çµ„
- **éƒ¨ç½²é¢¨éšª** - å–®ä¸€è®Šæ›´å¯èƒ½å½±éŸ¿æ•´å€‹ç³»çµ±çš„ç©©å®šæ€§

### å¯æ“´å±•æ¶æ§‹çš„è¨­è¨ˆåŸå‰‡

#### 1. æ¨¡çµ„åŒ–å„ªå…ˆè¨­è¨ˆ
```
å°ˆæ¡ˆçµæ§‹è¨­è¨ˆç†å¿µ
â”œâ”€â”€ æ ¸å¿ƒæ‡‰ç”¨å±¤ (app/)
â”‚   â”œâ”€â”€ Http/                  # HTTP ç›¸é—œ (Controllers, Middleware, Requests)
â”‚   â”œâ”€â”€ Models/                # Eloquent æ¨¡å‹
â”‚   â”œâ”€â”€ Services/              # æ ¸å¿ƒæ¥­å‹™æœå‹™
â”‚   â””â”€â”€ Shared/                # å…±ç”¨çµ„ä»¶ (Traits, Data Objects)
â”œâ”€â”€ æ¥­å‹™æ¨¡çµ„å±¤ (modules/)
â”‚   â”œâ”€â”€ User/                  # ç”¨æˆ¶ç®¡ç†æ¨¡çµ„
â”‚   â”œâ”€â”€ Profile/               # å€‹äººè³‡æ–™æ¨¡çµ„
â”‚   â””â”€â”€ [å…¶ä»–æ¥­å‹™æ¨¡çµ„]/
â”œâ”€â”€ é…ç½®å±¤ (config/)
â”‚   â”œâ”€â”€ æ‡‰ç”¨é…ç½®æª”æ¡ˆ
â”‚   â””â”€â”€ å¥—ä»¶é…ç½®æª”æ¡ˆ
â””â”€â”€ åŸºç¤è¨­æ–½å±¤
    â”œâ”€â”€ routes/                # è·¯ç”±å®šç¾©
    â”œâ”€â”€ database/              # è³‡æ–™åº«ç›¸é—œ (é·ç§»ã€ç¨®å­)
    â””â”€â”€ tests/                 # æ¸¬è©¦æª”æ¡ˆ
```

#### 2. API ç‚ºä¸­å¿ƒçš„è¨­è¨ˆ
- **API First ç†å¿µ** - æ‰€æœ‰åŠŸèƒ½éƒ½é€é API æä¾›ï¼Œç¢ºä¿å‰å¾Œç«¯å®Œå…¨è§£è€¦
- **ç‰ˆæœ¬åŒ–æ¶æ§‹** - å¾ä¸€é–‹å§‹å°±è€ƒæ…® API ç‰ˆæœ¬ç®¡ç†å’Œå‘å¾Œç›¸å®¹æ€§
- **RESTful æ¨™æº–** - éµå¾ª REST åŸå‰‡ï¼Œæä¾›ä¸€è‡´çš„ API é«”é©—

#### 3. å®¹å™¨åŒ–å°±ç·’
- **ç’°å¢ƒä¸€è‡´æ€§** - ç¢ºä¿é–‹ç™¼ã€æ¸¬è©¦ã€ç”Ÿç”¢ç’°å¢ƒçš„ä¸€è‡´æ€§
- **å¾®æœå‹™æº–å‚™** - ç‚ºæœªä¾†å¯èƒ½çš„å¾®æœå‹™åŒ–å¥ å®šåŸºç¤
- **DevOps å‹å–„** - æ”¯æ´ç¾ä»£åŒ–çš„ CI/CD æµç¨‹

## ğŸ”§ æ ¸å¿ƒå¥—ä»¶é¸æ“‡ç­–ç•¥

### æ ¸å¿ƒå¥—ä»¶æ¶æ§‹

æœ¬å°ˆæ¡ˆç²¾é¸çš„å¥—ä»¶çµ„åˆå°ˆç‚ºå¯æ“´å±•çš„ä¼æ¥­ç´š API è¨­è¨ˆï¼š

**èªè­‰èˆ‡æ¬Šé™å±¤**
- `laravel/sanctum` - è¼•é‡ç´š API Token èªè­‰
- `binary-cats/laravel-rbac` - ä¼æ¥­ç´š RBAC æ¬Šé™ç®¡ç†ï¼ˆä½¿ç”¨ PHP æšèˆ‰ï¼‰
- `spatie/laravel-one-time-passwords` - ä¸€æ¬¡æ€§å¯†ç¢¼ (OTP) èªè­‰ç³»çµ±

**æ¶æ§‹è¨­è¨ˆå±¤**
- `nwidart/laravel-modules` - æ¨¡çµ„åŒ–æ¶æ§‹ç®¡ç†
- `spatie/laravel-data` - å¼·å‹åˆ¥ DTO å’Œè³‡æ–™é©—è­‰

**é–‹ç™¼å“è³ªå±¤**
- `pestphp/pest` - ç¾ä»£åŒ–æ¸¬è©¦æ¡†æ¶
- `hotmeteor/spectator` - OpenAPI è¦æ ¼é©—è­‰

> **å¥—ä»¶é¸æ“‡ç†å¿µï¼š** æ¯å€‹å¥—ä»¶éƒ½è§£æ±ºç‰¹å®šçš„æ¶æ§‹å•é¡Œï¼Œä¸”å½¼æ­¤ç›¸å®¹æ€§è‰¯å¥½ï¼Œæ”¯æ´å¤§å‹å°ˆæ¡ˆçš„é•·æœŸç¶­è­·éœ€æ±‚ã€‚OTP ç³»çµ±ç‚º API æä¾›é¡å¤–çš„å®‰å…¨å±¤ï¼Œç‰¹åˆ¥é©ç”¨æ–¼æ•æ„Ÿæ“ä½œå’ŒäºŒå› ç´ èªè­‰å ´æ™¯ã€‚

## âš™ï¸ å°ˆæ¡ˆåˆå§‹åŒ–æœ€ä½³å¯¦è¸

### 1. ç’°å¢ƒé…ç½®ç­–ç•¥

#### å¤šç’°å¢ƒé…ç½®ç®¡ç†
```bash
# ç’°å¢ƒæª”æ¡ˆçµæ§‹
.env                    # æœ¬åœ°é–‹ç™¼ç’°å¢ƒ
.env.testing           # æ¸¬è©¦ç’°å¢ƒ
.env.staging           # é ç™¼å¸ƒç’°å¢ƒ
.env.production        # ç”Ÿç”¢ç’°å¢ƒ
.env.example           # ç’°å¢ƒç¯„æœ¬
```

#### é—œéµé…ç½®é …ç›®
```bash
# å°ˆæ¡ˆç’°å¢ƒè¨­å®š
APP_ENV=production
APP_URL=https://api.yourproject.com

# API æ•ˆèƒ½è¨­å®š
CACHE_STORE=redis
QUEUE_CONNECTION=redis
```

> **ç’°å¢ƒé…ç½®ç­–ç•¥ï¼š** å®Œæ•´çš„å¤šç’°å¢ƒé…ç½®ç¯„æœ¬è«‹åƒè€ƒå°ˆæ¡ˆæ ¹ç›®éŒ„çš„ `.env.example` æª”æ¡ˆã€‚

> **é€²éšé…ç½®èªªæ˜ï¼š** 
> - Sanctum èªè­‰é…ç½®è«‹åƒè€ƒï¼š`config/sanctum.php`
> - æ¨¡çµ„åŒ–è¨­å®šè«‹åƒè€ƒï¼š`config/modules.php` 
> - RBAC æ¬Šé™é…ç½®è«‹åƒè€ƒï¼š`config/rbac.php`

### 2. å¥—ä»¶å®‰è£é †åº

#### ç¬¬ä¸€éšæ®µï¼šæ ¸å¿ƒæ¶æ§‹
```bash
# 1. å®‰è£ API èªè­‰
composer require laravel/sanctum

# 2. å®‰è£ä¸€æ¬¡æ€§å¯†ç¢¼ç³»çµ±
composer require spatie/laravel-one-time-passwords

# 3. å®‰è£æ¨¡çµ„åŒ–å¥—ä»¶
composer require nwidart/laravel-modules

# 4. å®‰è£æ¬Šé™ç®¡ç†
composer require spatie/laravel-permission
composer require binary-cats/laravel-rbac
```

#### ç¬¬äºŒéšæ®µï¼šé–‹ç™¼å·¥å…·
```bash
# 5. å®‰è£è³‡æ–™è™•ç†å¥—ä»¶
composer require spatie/laravel-data

# 6. å®‰è£æ¸¬è©¦æ¡†æ¶
composer require --dev pestphp/pest
composer require --dev pestphp/pest-plugin-laravel
composer require --dev hotmeteor/spectator
```

### 3. è¨­å®šç™¼å¸ƒèˆ‡åˆå§‹åŒ–

#### æ ¸å¿ƒè¨­å®šç™¼å¸ƒ
```bash
# ç™¼å¸ƒ Sanctum è¨­å®š
php artisan vendor:publish --provider="Laravel\Sanctum\SanctumServiceProvider"

# ç™¼å¸ƒ OTP è¨­å®š
php artisan vendor:publish --provider="Spatie\OneTimePasswords\OneTimePasswordsServiceProvider"

# ç™¼å¸ƒæ¨¡çµ„è¨­å®š
php artisan vendor:publish --provider="Nwidart\Modules\LaravelModulesServiceProvider"

# ç™¼å¸ƒæ¬Šé™è¨­å®š
php artisan vendor:publish --provider="Spatie\Permission\PermissionServiceProvider"
php artisan vendor:publish --tag="rbac-config"

# åŸ·è¡Œè³‡æ–™åº«é·ç§»
php artisan migrate
```

#### API è·¯ç”±åˆå§‹åŒ–
```bash
# Laravel 11+ å®‰è£ API è·¯ç”±
php artisan install:api

# æ¸…ç†ä¸éœ€è¦çš„ Web è³‡æº
rm -rf resources/views
rm -rf resources/js
rm -rf resources/css
```

## ğŸ—ï¸ å°ˆæ¡ˆçµæ§‹è¨­è¨ˆ

### å¯æ“´å±•çš„ç›®éŒ„æ¶æ§‹
```
laravel-api-project/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ Http/
â”‚   â”‚   â”œâ”€â”€ Controllers/API/    # API æ§åˆ¶å™¨ (æŒ‰ç‰ˆæœ¬åˆ†çµ„)
â”‚   â”‚   â”œâ”€â”€ Middleware/         # è‡ªè¨‚ä¸­é–“ä»¶
â”‚   â”‚   â”œâ”€â”€ Requests/           # è¡¨å–®é©—è­‰è«‹æ±‚
â”‚   â”‚   â””â”€â”€ Resources/          # API è³‡æºè½‰æ›
â”‚   â”œâ”€â”€ Services/               # æ¥­å‹™é‚è¼¯æœå‹™
â”‚   â”œâ”€â”€ Repositories/           # è³‡æ–™å­˜å–å±¤
â”‚   â”œâ”€â”€ Data/                   # è³‡æ–™å‚³è¼¸ç‰©ä»¶
â”‚   â”œâ”€â”€ Models/                 # Eloquent æ¨¡å‹
â”‚   â”œâ”€â”€ Abilities/              # æ¬Šé™å®šç¾© (Enums)
â”‚   â”œâ”€â”€ Roles/                  # è§’è‰²å®šç¾©
â”‚   â”œâ”€â”€ Events/                 # äº‹ä»¶å®šç¾©
â”‚   â”œâ”€â”€ Listeners/              # äº‹ä»¶ç›£è½å™¨
â”‚   â”œâ”€â”€ Jobs/                   # ä½‡åˆ—ä»»å‹™
â”‚   â”œâ”€â”€ Exceptions/             # è‡ªè¨‚ä¾‹å¤–
â”‚   â””â”€â”€ Shared/                 # å…±ç”¨çµ„ä»¶
â”‚       â”œâ”€â”€ Contracts/          # ä»‹é¢å¥‘ç´„
â”‚       â”œâ”€â”€ Services/           # å…±ç”¨æœå‹™
â”‚       â”œâ”€â”€ Traits/             # é‡ç”¨ç‰¹å¾µ
â”‚       â””â”€â”€ Enums/              # åˆ—èˆ‰å®šç¾©
â”œâ”€â”€ modules/                    # åŠŸèƒ½æ¨¡çµ„
â”‚   â”œâ”€â”€ User/                   # ç”¨æˆ¶ç®¡ç†æ¨¡çµ„
â”‚   â”œâ”€â”€ Profile/                # å€‹äººè³‡æ–™æ¨¡çµ„
â”‚   â”œâ”€â”€ Authentication/         # èªè­‰æ¨¡çµ„
â”‚   â””â”€â”€ Notification/           # é€šçŸ¥æ¨¡çµ„
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ modules.php             # æ¨¡çµ„è¨­å®š
â”‚   â”œâ”€â”€ rbac.php               # æ¬Šé™è¨­å®š
â”‚   â””â”€â”€ sanctum.php            # API èªè­‰è¨­å®š
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ migrations/             # è³‡æ–™åº«é·ç§»
â”‚   â”œâ”€â”€ seeders/               # è³‡æ–™å¡«å……
â”‚   â””â”€â”€ factories/             # æ¨¡å‹å·¥å» 
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ api.php                # ä¸»è¦ API è·¯ç”±
â”‚   â”œâ”€â”€ v1.php                 # V1 ç‰ˆæœ¬è·¯ç”±
â”‚   â””â”€â”€ v2.php                 # V2 ç‰ˆæœ¬è·¯ç”±
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ Feature/               # åŠŸèƒ½æ¸¬è©¦
â”‚   â”‚   â”œâ”€â”€ API/               # API æ¸¬è©¦
â”‚   â”‚   â””â”€â”€ Modules/           # æ¨¡çµ„æ¸¬è©¦
â”‚   â”œâ”€â”€ Unit/                  # å–®å…ƒæ¸¬è©¦
â”‚   â””â”€â”€ Traits/                # æ¸¬è©¦è¼”åŠ©
â””â”€â”€ docs/                      # å°ˆæ¡ˆæ–‡ä»¶
    â”œâ”€â”€ api/                   # API æ–‡ä»¶
    â””â”€â”€ guides/                # é–‹ç™¼æŒ‡å—
```

## ğŸ”§ é€²éšé…ç½®æœ€ä½³åŒ–

### 1. API å°ˆç”¨è¨­å®š

#### Sanctum èªè­‰æ¶æ§‹
Laravel Sanctum ç‚º API æä¾›è¼•é‡ç´šä½†å¼·å¤§çš„èªè­‰æ©Ÿåˆ¶ï¼š

**æ ¸å¿ƒç‰¹è‰²ï¼š**
- SPA å’Œè¡Œå‹•æ‡‰ç”¨çš„ç„¡ç‹€æ…‹èªè­‰
- Token ä½œç”¨åŸŸç®¡ç†ï¼Œæ”¯æ´ç´°ç²’åº¦æ¬Šé™æ§åˆ¶
- å¤š Guard æ”¯æ´ï¼ŒWeb å’Œ API èªè­‰ä¸¦å­˜

> **Sanctum å®Œæ•´é…ç½®è«‹åƒè€ƒï¼š** `config/sanctum.php`

#### API è·¯ç”±æ¶æ§‹è¨­è¨ˆ
```bash
# Laravel 11+ API è·¯ç”±è¨­ç½®
php artisan install:api

# ç§»é™¤ Web UI ç›¸é—œè³‡æºï¼ˆç´” API å°ˆæ¡ˆï¼‰
rm -rf resources/views resources/js resources/css
```

**è¨­è¨ˆé‡é»ï¼š**
- Token éæœŸæ™‚é–“ç­–ç•¥
- è·¯ç”±é™æµé…ç½®
- CORS è·¨åŸŸæ”¿ç­–

> **API è·¯ç”±é…ç½®è«‹åƒè€ƒï¼š** `routes/api.php` å’Œç›¸é—œè·¯ç”±æª”æ¡ˆ

### 2. æ•ˆèƒ½æœ€ä½³åŒ–é…ç½®

#### å¿«å–æ¶æ§‹ç­–ç•¥
ç‚ºå¤§å‹ API å°ˆæ¡ˆè¨­è¨ˆçš„å¤šå±¤å¿«å–ç­–ç•¥ï¼š

**å¿«å–åˆ†å±¤è¨­è¨ˆï¼š**
- **æ‡‰ç”¨å¿«å–** - Redis ä½œç‚ºä¸»è¦å¿«å–é©…å‹•
- **æŸ¥è©¢å¿«å–** - Eloquent æŸ¥è©¢çµæœå¿«å–
- **æ¬Šé™å¿«å–** - RBAC æ¬Šé™æª¢æŸ¥çµæœå¿«å–

> **å®Œæ•´å¿«å–é…ç½®è«‹åƒè€ƒï¼š** `config/cache.php`

#### è³‡æ–™åº«é€£ç·šæœ€ä½³åŒ–
é‡å°é«˜ä½µç™¼ API çš„è³‡æ–™åº«é…ç½®ç­–ç•¥ï¼š

**é—œéµæœ€ä½³åŒ–é …ç›®ï¼š**
- é€£ç·šæ± é…ç½®
- æŸ¥è©¢æœ€ä½³åŒ–è¨­å®š
- è®€å¯«åˆ†é›¢æº–å‚™

> **å®Œæ•´è³‡æ–™åº«é…ç½®è«‹åƒè€ƒï¼š** `config/database.php`

## ğŸ“Š è¨­ç½®é©—è­‰æ¸…å–®

### ç’°å¢ƒé©—è­‰
```bash
# æª¢æŸ¥ PHP ç‰ˆæœ¬å’Œæ“´å±•
php -v
php -m | grep -E "(pdo|mysql|redis|curl|json|mbstring|xml|zip)"

# æª¢æŸ¥ Composer å¥—ä»¶
composer show --platform

# é©—è­‰ Laravel å®‰è£
php artisan --version
php artisan route:list | grep api

# æ¸¬è©¦è³‡æ–™åº«é€£ç·š
php artisan tinker --execute="DB::connection()->getPdo();"

# æ¸¬è©¦å¿«å–é€£ç·š
php artisan tinker --execute="Cache::put('test', 'ok'); echo Cache::get('test');"
```

### åŠŸèƒ½é©—è­‰
```bash
# æ¸¬è©¦ API å¥åº·æª¢æŸ¥ç«¯é»
curl -X GET http://localhost:8000/api/health \
  -H "Accept: application/json"

# æ¸¬è©¦æ¬Šé™ç³»çµ±
php artisan rbac:list

# æ¸¬è©¦æ¨¡çµ„åŠŸèƒ½
php artisan module:list
```

æ­£ç¢ºçš„æ¡†æ¶è¨­ç½®æ˜¯æ•´å€‹å°ˆæ¡ˆæˆåŠŸçš„åŸºçŸ³ã€‚é€ééµå¾ªé€™äº›åŸå‰‡å’Œæœ€ä½³å¯¦è¸ï¼Œæˆ‘å€‘å»ºç«‹äº†ä¸€å€‹æ—¢å¼·å¤§åˆéˆæ´»çš„ API åŸºç¤æ¶æ§‹ï¼Œç‚ºå¾ŒçºŒçš„é–‹ç™¼å·¥ä½œå¥ å®šäº†ç©©å›ºçš„åŸºç¤ã€‚

---

**ä¸‹ä¸€æ­¥ï¼š** äº†è§£å¦‚ä½•è¨­è¨ˆæ¸…æ™°çš„ API æ¶æ§‹ â†’ [API è¨­è¨ˆ](03-api-design.md)
